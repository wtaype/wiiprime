import{$ as r}from"./main-wdEaf4-Z.js";import{i as j,g as S,a as O,b as E,d as y,c as B,q as N,e as F,w as D,f as _,u as T,s as q,h as V,j as W,k as X,l as H,o as J,m as K}from"./firebase-BY_ANOcx.js";import{a as b,w as h,b as m,M as v,s as P,c as f,g as I,r as U}from"./widev-aZ5GBlZ2.js";/* empty css                */import"./vendor-B2AETYxa.js";const Z={apiKey:"AIzaSyAw1I8I84eHjOk69UoAaM74k3OUAJMlET8",authDomain:"wiiprime.firebaseapp.com",projectId:"wiiprime",storageBucket:"wiiprime.firebasestorage.app",messagingSenderId:"560186875326",appId:"1:560186875326:web:1e8d7104fc7e53878b2def"},Y=j(Z),x=S(Y),w=O(Y);function G(){const n={db:"smiles",ls:"wiAuthIn",rol:"usuario"},p=(e,l,c)=>`<div id="${e}" class="wiModal authMod"><div class="modalBody"><button class="modalX">&times;</button><div class="modalMain"><div class="logo"><img src="./smile.png"></div><h2>${l}</h2><form id="${e.replace("Modal","Form")}">${c}</form></div></div></div>`,t=(e,l,c,A,a=!1)=>`<div class="grupo"><i class="fas fa-${e}"></i><input type="${l}" id="${c}" placeholder="${A}" required>${a?'<i class="fas fa-eye tgPass"></i>':""}</div>`,k={login:p("loginModal","Login",t("envelope","text","email","Email o usuario")+t("lock","password","password","Contraseña",!0)+'<button type="button" id="Login" class="btnAuth inactivo">Iniciar Sesión</button><div class="links"><span class="olvidastePass">¿Olvidaste tu contraseña?</span><span class="crearCuenta">Crear cuenta</span></div>'),registro:p("registroModal","Crear Cuenta",t("envelope","email","regEmail","Email")+t("user","text","regUsuario","Usuario")+t("user-tie","text","regNombre","Nombre")+t("user-tie","text","regApellidos","Apellidos")+t("lock","password","regPassword","Contraseña",!0)+t("lock","password","regPassword1","Confirmar",!0)+'<button type="button" id="Registrar" class="btnAuth inactivo">Registrarme</button><div class="links"><span class="conCuenta">Ya tengo cuenta</span></div>').replace("authMod","authMod regMod"),reset:p("recuperarModal","Restablecer","<p>Ingresa tu Email o usuario:</p>"+t("envelope","text","recEmail","Email o usuario")+'<button type="button" id="Recuperar" class="btnAuth inactivo">Enviar enlace</button><div class="links"><span class="volverLogin"><i class="fas fa-arrow-left"></i> Volver</span></div>')},M=".authMod .modalBody{max-width:28vw;min-width:320px;padding:0;background:var(--bg);border-radius:1.5vh;box-shadow:0 10px 40px rgba(0,0,0,.15);animation:mIn .3s ease}@keyframes mIn{from{transform:translateY(-30px) scale(.9);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}.regMod .modalBody{max-width:40vw}.modalMain{padding:3vh 2.5vw;display:flex;flex-direction:column;align-items:center}.logo{width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:2vh 0 1.5vh;box-shadow:0 8px 24px var(--bxs);background:linear-gradient(135deg,var(--mco),var(--hv));animation:lf 3s ease-in-out infinite}@keyframes lf{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}.logo:hover{transform:scale(1.05) rotate(5deg)}.logo img{width:90%;transition:transform .3s}.logo:hover img{transform:scale(1.1)}h2{font:700 1.8rem var(--ff_P);color:var(--mco);margin:.5vh 0 2vh;text-align:center}form{width:100%;display:flex;flex-direction:column;gap:1.5vh}.grupo{position:relative;width:100%;animation:fiu .4s ease backwards}.grupo:nth-child(n){animation-delay:calc(var(--i, 0) * .05s)}@keyframes fiu{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.grupo i{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:var(--mco);opacity:.8;font-size:1.1rem;z-index:2;pointer-events:none;transition:all .3s}.grupo:focus-within i{opacity:1;color:var(--hv);transform:translateY(-50%) scale(1.1)}.tgPass{left:auto!important;right:1rem!important;cursor:pointer;pointer-events:all!important;z-index:3!important;opacity:.6;color:var(--txe)}.tgPass:hover{opacity:1;color:var(--mco);transform:translateY(-50%) scale(1.15)!important}input{width:100%;padding:1.3vh 3.5rem 1.3vh 3rem;border-radius:.8vh;border:1.5px solid var(--bdr);background:var(--wb);color:var(--tx);font-size:.95rem;transition:all .3s;outline:0;box-sizing:border-box}input:hover{border-color:var(--mco);transform:translateY(-1px)}input:focus{border-color:var(--mco);box-shadow:0 0 0 3px var(--bxs),0 4px 12px rgba(0,0,0,.08);transform:translateY(-2px);background:var(--F)}input::placeholder{color:var(--txe);opacity:.6}.btnAuth{width:100%;padding:1.4vh 1.5vw;background:linear-gradient(135deg,var(--mco),var(--hv));color:var(--txa);border:0;border-radius:.8vh;font-weight:600;font-size:1rem;cursor:pointer;box-shadow:0 6px 20px var(--bxs);transition:all .3s;position:relative;overflow:hidden;animation:fiu .4s ease .4s backwards}.btnAuth::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,.2);transform:translate(-50%,-50%);transition:width .6s,height .6s}.btnAuth:hover::before{width:300px;height:300px}.btnAuth:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 10px 30px var(--bxs)}.btnAuth:active{transform:translateY(-1px) scale(.98)}.btnAuth.loading{opacity:.8;cursor:wait;pointer-events:none;animation:pul 1.5s ease-in-out infinite}@keyframes pul{0%,100%{opacity:.8}50%{opacity:.6}}.btnAuth.inactivo{opacity:.65;cursor:not-allowed;pointer-events:none;filter:grayscale(40%)}.btnAuth i{margin-right:.3vw}.links{width:100%;display:flex;justify-content:space-between;margin-top:1.5vh;gap:1vh;animation:fiu .4s ease .45s backwards}.links span{color:var(--mco);cursor:pointer;padding:.6vh .8vw;font-size:.95rem;font-weight:500;border-radius:.5vh;transition:all .25s;position:relative}.links span::after{content:'';position:absolute;bottom:0;left:50%;width:0;height:2px;background:var(--mco);transition:all .3s;transform:translateX(-50%)}.links span:hover{color:var(--hv);transform:translateY(-2px)}.links span:hover::after{width:100%}p{color:var(--tx);font-size:.95rem;margin:1.5vh 0 .8vh;opacity:.85;font-weight:500}#registroForm{display:grid;grid-template-columns:1fr 1fr;gap:1.5vh 1.5vw}#registroForm .btnAuth,#registroForm .links{grid-column:1/-1;margin-top:1vh}@media (max-width:1200px){.authMod .modalBody{max-width:35vw}.regMod .modalBody{max-width:50vw}}@media (max-width:768px){.authMod .modalBody{max-width:98vw}.regMod .modalBody{max-width:98vw}.modalMain{padding:2.5vh 5vw}h2{font-size:1.5rem}.logo{width:70px;height:70px}input{padding:1.2vh 3rem 1.2vh 2.5rem}.grupo i{left:.8rem}.tgPass{right:.8rem!important}.btnAuth{padding:1.5vh 4vw;font-size:.95rem}#registroForm{display:flex;flex-direction:column;gap:1.5vh}}";let g=!1;const z=()=>{g||(r("body").append(Object.values(k).join("")),g=!0,R())};!r(".wiAuthCss").length&&r("head").append(`<style class="wiAuthCss">${M}</style>`);const $={regEmail:[e=>e.toLowerCase().trim(),e=>/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(e)||"Email inválido"],regUsuario:[e=>e.toLowerCase().replace(/[^a-z0-9_]/g,"").trim(),e=>e.length>=4||"Usuario 4-20 caracteres"],regNombre:[e=>e.trim(),e=>e.length>0||"Ingrese nombre"],regApellidos:[e=>e.trim(),e=>e.length>0||"Ingrese apellidos"],regPassword:[e=>e,e=>e.length>=6||"Mínimo 6 caracteres"],regPassword1:[e=>e,e=>e===r("#regPassword").val()||"No coinciden"]},R=()=>{let e=!1,l=!1,c=!1;r(document).off("click.wa",".tgPass").on("click.wa",".tgPass",function(){const a=r(this).siblings("input");a.attr("type",a.attr("type")==="password"?"text":"password"),r(this).toggleClass("fa-eye fa-eye-slash")}),r(document).off("input.wa","#regUsuario,#regEmail,#email,#recEmail").on("input.wa","#regUsuario,#regEmail,#email,#recEmail",function(){r(this).val(r(this).val().toLowerCase())}),[["#password","#Login"],["#regPassword1","#Registrar"],["#recEmail","#Recuperar"]].forEach(([a,o])=>{r(document).off("input.wa keyup.wa",a).on("input.wa keyup.wa",a,i=>{r(o).removeClass("inactivo"),i.key==="Enter"&&r(o).click()})}),Object.entries($).forEach(([a,[o,i]])=>{r(document).off("blur.wa",`#${a}`).on("blur.wa",`#${a}`,function(){const s=o(r(this).val());r(this).val(s);const d=i(s);d!==!0&&h(this,d,"error",2500)})}),r(document).off("blur.wa focus.wa","#regUsuario").on("blur.wa focus.wa","#regUsuario",async function(){const a=r(this).val().trim();if(a.includes("@")){h(this,"Usuario no puede contener @","error",2500),e=!1;return}if(a.length>=3)try{const o=await E(y(w,n.db,a));e=!o.exists(),h(this,`Usuario ${o.exists()?"no disponible ❌":"disponible ✅"}`,e?"success":"error",3e3)}catch(o){console.error(o)}}),r(document).off("blur.wa focus.wa","#regEmail").on("blur.wa focus.wa","#regEmail",async function(){const a=r(this).val().trim();if(a.length>0&&!a.includes("@")){h(this,"Debe ser un email válido","error",2500),l=!1;return}if(a.length>=3&&a.includes("@"))try{const o=await B(N(F(w,n.db),D("email","==",a)));l=o.empty,h(this,`Email ${o.empty?"disponible ✅":"no disponible ❌"}`,l?"success":"error",3e3)}catch(o){console.error(o)}}),r(document).off("click.wa","#Registrar").on("click.wa","#Registrar",async function(){if(c)return;c=!0,m(this,!0,"Registrando");const a=[[e,r("#regUsuario")[0],"Usuario no disponible"],[l,r("#regEmail")[0],"Email no disponible"],...Object.entries($).map(([o,[i,s]])=>{const d=r(`#${o}`),C=i(d.val()),u=s(C);return[u===!0,d[0],u!==!0?u:""]})];for(const[o,i,s]of a)if(!o&&s){m(this,!1),h(i,s,"error",2500),i.focus(),c=!1;return}try{const[o,i,s,d,C]=["regEmail","regUsuario","regNombre","regApellidos","regPassword"].map(L=>r(`#${L}`).val().trim()),{user:u}=await _(x,o,C);await Promise.all([T(u,{displayName:i}),q(u)]),await V(y(w,n.db,i),{usuario:i,email:o,nombre:s,apellidos:d,rol:n.rol,creacion:W(),uid:u.uid}),v("¡Registro completado! ✅"),P(n.ls,"wIn",24),f("registroModal")}catch(o){v({"auth/email-already-in-use":"Email ya registrado","auth/weak-password":"Contraseña débil"}[o.code]||o.message,"error"),console.error(o)}finally{m(this,!1),c=!1}}),r(document).off("click.wa","#Login").on("click.wa","#Login",async function(){m(this,!0,"Iniciando");try{const[a,o]=["#email","#password"].map(s=>r(s).val().trim());let i=a;if(!a.includes("@")){const s=await E(y(w,n.db,a));if(!s.exists())throw new Error("Usuario no encontrado");i=s.data().email}await X(x,i,o),P(n.ls,"wIn",24),f("loginModal")}catch(a){v({"auth/invalid-credential":"Contraseña incorrecta","auth/invalid-email":"Email no válido","auth/missing-email":"Usuario no registrado"}[a.code]||a.message,"error"),console.error(a)}finally{m(this,!1)}}),r(document).off("click.wa","#Recuperar").on("click.wa","#Recuperar",async function(){m(this,!0,"Enviando");try{const a=r("#recEmail").val().trim();let o=a;if(!a.includes("@")){const i=await E(y(w,n.db,a));if(!i.exists())throw new Error("Usuario no encontrado");o=i.data().email}await H(x,o),v("✅ Email enviado para restablecer contraseña","success")}catch(a){v(a.message||"Error al enviar email","error"),console.error(a)}finally{m(this,!1)}});const A={crearCuenta:()=>{b("registroModal"),f("loginModal")},conCuenta:()=>{b("loginModal"),f("registroModal")},olvidastePass:()=>{b("recuperarModal"),f("loginModal")},volverLogin:()=>{b("loginModal"),f("recuperarModal")}};r(document).off("click.wa",".crearCuenta,.conCuenta,.olvidastePass,.volverLogin").on("click.wa",".crearCuenta,.conCuenta,.olvidastePass,.volverLogin",function(){A[r(this).attr("class").split(" ")[0]]()})};r(document).off("click.wa",".login,.registrar").on("click.wa",".login,.registrar",function(e){e.preventDefault(),z(),setTimeout(()=>b(r(this).hasClass("login")?"loginModal":"registroModal"),100)}),console.log("✅ wiAuth() v11.4 DEFINITIVO")}G();const ta=(()=>{(function(){let t=I("wiSmile");t?p(t):n()})();function n(){r(".wiauth").html('<button class="wibtn_auth registrar"><i class="fas fa-user-plus"></i><span>Registrar</span></button><button class="wibtn_auth login"><i class="fas fa-sign-in-alt"></i><span>Login</span></button>')}function p(t){v("Bienvenido "+t.nombre),r(".wiauth").html(`
      <div class="sesion">
        <img src="${t.imagen||"./smile.png"}" alt="${t.nombre}"><span>${t.nombre}</span>
      </div>
      <button class="bt_salir"><i class="fas fa-sign-out-alt"></i> Salir</button>
    `)}J(x,async t=>{if(!t)return U("wiSmile"),n();let k=I("wiSmile");if(!(k&&k.usuario===t.displayName))try{let g=(await E(y(w,"smiles",t.displayName))).data();g&&(P("wiSmile",g,450),p(g))}catch(M){console.error(M)}}),r(document).on("click",".bt_salir",async()=>{await K(x),U("wiSmile"),n()})})();export{ta as header};
